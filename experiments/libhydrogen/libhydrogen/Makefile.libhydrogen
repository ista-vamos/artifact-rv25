
export LLVM_COMPILER=clang

WLLVM=wllvm
WLLVMXX=wllvm++
LLVM_AR?=llvm-ar

all: libhydrogen.bca

libhydrogen.bca: libhydrogen/CMakeCache.txt
	cd libhydrogen && make && extract-bc --archiver=$(LLVM_AR) libhydrogen.a && cp libhydrogen.bca ..

libhydrogen/CMakeCache.txt: libhydrogen/CMakeLists.txt
	cd libhydrogen && cmake . -DCMAKE_C_COMPILER=$(WLLVM) -DCMAKE_CXX_COMPILER=$(WLLVMXX) -DCMAKE_BUILD_TYPE=Debug

libhydrogen/CMakeLists.txt:
	tar xf ../cryptomk-dataset/dataset/src/libhydrogen.tar.gz
